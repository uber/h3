"use strict";(self.webpackChunkh3_website=self.webpackChunkh3_website||[]).push([[9121],{3905:(e,t,o)=>{o.d(t,{Zo:()=>m,kt:()=>d});var r=o(7294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},a=Object.keys(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var c=r.createContext({}),s=function(e){var t=r.useContext(c),o=t;return e&&(o="function"==typeof e?e(t):l(l({},t),e)),o},m=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var o=e.components,n=e.mdxType,a=e.originalType,c=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),u=s(o),d=n,y=u["".concat(c,".").concat(d)]||u[d]||p[d]||a;return o?r.createElement(y,l(l({ref:t},m),{},{components:o})):r.createElement(y,l({ref:t},m))}));function d(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=o.length,l=new Array(a);l[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:n,l[1]=i;for(var s=2;s<a;s++)l[s]=o[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,o)}u.displayName="MDXCreateElement"},7025:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>s});var r=o(7462),n=(o(7294),o(3905));const a={id:"custom-alloc",title:"Memory allocation",sidebar_label:"Memory allocation",slug:"/core-library/custom-alloc"},l=void 0,i={unversionedId:"core-library/custom-alloc",id:"core-library/custom-alloc",title:"Memory allocation",description:"H3's approach to memory management is to rely on memory allocated by the caller as much as possible. This allows memory to be managed by an external framework.",source:"@site/docs/core-library/custom-alloc.md",sourceDirName:"core-library",slug:"/core-library/custom-alloc",permalink:"/docs/core-library/custom-alloc",draft:!1,editUrl:"https://github.com/uber/h3/edit/master/website/docs/core-library/custom-alloc.md",tags:[],version:"current",frontMatter:{id:"custom-alloc",title:"Memory allocation",sidebar_label:"Memory allocation",slug:"/core-library/custom-alloc"},sidebar:"someSidebar",previous:{title:"Testing strategy",permalink:"/docs/core-library/testing"},next:{title:"Public API",permalink:"/docs/core-library/usage"}},c={},s=[{value:"Custom Memory Allocators",id:"custom-memory-allocators",level:2}],m={toc:s};function p(e){let{components:t,...o}=e;return(0,n.kt)("wrapper",(0,r.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"H3's approach to memory management is to rely on memory allocated by the caller as much as possible. This allows memory to be managed by an external framework."),(0,n.kt)("p",null,"In some cases (for example, ",(0,n.kt)("inlineCode",{parentName:"p"},"polygonToCells"),"), H3 allocates heap memory. When this is needed, it uses the standard C memory allocation functions."),(0,n.kt)("h2",{id:"custom-memory-allocators"},"Custom Memory Allocators"),(0,n.kt)("admonition",{type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"On some systems, such as Windows, the undefined symbols cannot be undefined at build time. Further changes to the H3 build are needed to provide custom implementations.")),(0,n.kt)("admonition",{type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"There are a few algorithms like ",(0,n.kt)("inlineCode",{parentName:"p"},"kRing")," that still use the call stack to recurse and could run out of memory that way.")),(0,n.kt)("p",null,"H3 supports replacing the memory management functions (",(0,n.kt)("inlineCode",{parentName:"p"},"malloc"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"calloc"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"realloc"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"free"),") used by the library at build time. This can be used to integrate H3 within a managed framework."),(0,n.kt)("p",null,"When using custom memory allocators, H3 prefixes the names of memory allocation functions with the string you specify. The application linking H3 must have the prefixed replacement functions defined, or you must change the H3 build to link against the prefixed replacement functions."),(0,n.kt)("p",null,"When building H3, specify the ",(0,n.kt)("inlineCode",{parentName:"p"},"H3_ALLOC_PREFIX")," option to your prefix of choice, as below:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"cmake -DH3_ALLOC_PREFIX=my_prefix_ .\n")),(0,n.kt)("p",null,"Then, in your application using H3, implement the following functions, replacing ",(0,n.kt)("inlineCode",{parentName:"p"},"my_prefix_")," with the prefix you chose above:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-c"},"void* my_prefix_malloc(size_t size);\nvoid* my_prefix_calloc(size_t num, size_t size);\nvoid* my_prefix_realloc(void* ptr, size_t size);\nvoid my_prefix_free(void* ptr);\n")),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"H3 does not currently use ",(0,n.kt)("inlineCode",{parentName:"p"},"realloc"),".")),(0,n.kt)("p",null,"Link to H3 as you would have without the custom allocators. The custom allocators will be used for allocating heap memory in H3."))}p.isMDXComponent=!0}}]);