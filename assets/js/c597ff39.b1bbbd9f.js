"use strict";(self.webpackChunkh3_website=self.webpackChunkh3_website||[]).push([[3919],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),d=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),p=d(n),m=a,g=p["".concat(s,".").concat(m)]||p[m]||c[m]||i;return n?r.createElement(g,l(l({ref:t},u),{},{components:n})):r.createElement(g,l({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=p;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var d=2;d<i;d++)l[d]=n[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3045:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var r=n(7462),a=(n(7294),n(3905));const i={id:"testing",title:"Testing strategy",sidebar_label:"Testing strategy",slug:"/core-library/testing"},l=void 0,o={unversionedId:"core-library/testing",id:"core-library/testing",title:"Testing strategy",description:"The H3 developers try to ensure the robustness and reliability of the H3 library. Tools used to do this include defensive code, unit tests with coverage reporting, and fuzzing.",source:"@site/docs/core-library/testing.md",sourceDirName:"core-library",slug:"/core-library/testing",permalink:"/docs/core-library/testing",draft:!1,editUrl:"https://github.com/uber/h3/edit/master/website/docs/core-library/testing.md",tags:[],version:"current",frontMatter:{id:"testing",title:"Testing strategy",sidebar_label:"Testing strategy",slug:"/core-library/testing"},sidebar:"someSidebar",previous:{title:"Compilation options",permalink:"/docs/core-library/compilation-options"},next:{title:"Memory allocation",permalink:"/docs/core-library/custom-alloc"}},s={},d=[{value:"Unit testing",id:"unit-testing",level:2},{value:"Defensive code",id:"defensive-code",level:2},{value:"Benchmarks",id:"benchmarks",level:2},{value:"Fuzzers",id:"fuzzers",level:2}],u={toc:d};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The H3 developers try to ensure the robustness and reliability of the H3 library. Tools used to do this include defensive code, unit tests with coverage reporting, and fuzzing."),(0,a.kt)("p",null,"The H3 library may despite these efforts behave unexpectedly; in these cases the developers\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/uber/h3/blob/master/CONTRIBUTING.md"},"welcome feedback and contributions"),"."),(0,a.kt)("h2",{id:"unit-testing"},"Unit testing"),(0,a.kt)("p",null,"Github Actions are used to run the H3 test suite for every commit. A variety of configurations, described below, are tested."),(0,a.kt)("p",null,"Coverage information is collected in Coveralls. Because of the self-contained nature of the H3 library, we seek to have as close to 100% code coverage as possible."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Operating system"),(0,a.kt)("th",{parentName:"tr",align:null},"Compiler"),(0,a.kt)("th",{parentName:"tr",align:null},"Build type"),(0,a.kt)("th",{parentName:"tr",align:null},"Processor architecture"),(0,a.kt)("th",{parentName:"tr",align:null},"Special notes"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Linux (Ubuntu)"),(0,a.kt)("td",{parentName:"tr",align:null},"Clang"),(0,a.kt)("td",{parentName:"tr",align:null},"Debug, Release"),(0,a.kt)("td",{parentName:"tr",align:null},"x64"),(0,a.kt)("td",{parentName:"tr",align:null},"clang-format-14 is used to ensure all code is consistently formatted")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Linux"),(0,a.kt)("td",{parentName:"tr",align:null},"Clang"),(0,a.kt)("td",{parentName:"tr",align:null},"Debug"),(0,a.kt)("td",{parentName:"tr",align:null},"x64"),(0,a.kt)("td",{parentName:"tr",align:null},"An additional copy of the job runs with ",(0,a.kt)("a",{parentName:"td",href:"https://valgrind.org/"},"Valgrind"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Linux"),(0,a.kt)("td",{parentName:"tr",align:null},"Clang"),(0,a.kt)("td",{parentName:"tr",align:null},"Debug"),(0,a.kt)("td",{parentName:"tr",align:null},"x64"),(0,a.kt)("td",{parentName:"tr",align:null},"An additional copy of the job runs with coverage reporting, and excerising the ",(0,a.kt)("inlineCode",{parentName:"td"},"H3_PREFIX")," mechanism.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Linux"),(0,a.kt)("td",{parentName:"tr",align:null},"gcc"),(0,a.kt)("td",{parentName:"tr",align:null},"Debug, Release"),(0,a.kt)("td",{parentName:"tr",align:null},"x64"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Mac OS"),(0,a.kt)("td",{parentName:"tr",align:null},"Apple Clang"),(0,a.kt)("td",{parentName:"tr",align:null},"Debug, Release"),(0,a.kt)("td",{parentName:"tr",align:null},"x64"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Windows"),(0,a.kt)("td",{parentName:"tr",align:null},"MSVC"),(0,a.kt)("td",{parentName:"tr",align:null},"Debug, Release"),(0,a.kt)("td",{parentName:"tr",align:null},"x64"),(0,a.kt)("td",{parentName:"tr",align:null},"Static library")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Windows"),(0,a.kt)("td",{parentName:"tr",align:null},"MSVC"),(0,a.kt)("td",{parentName:"tr",align:null},"Debug, Release"),(0,a.kt)("td",{parentName:"tr",align:null},"x86"),(0,a.kt)("td",{parentName:"tr",align:null},"Static library")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Windows"),(0,a.kt)("td",{parentName:"tr",align:null},"MSVC"),(0,a.kt)("td",{parentName:"tr",align:null},"Debug, Release"),(0,a.kt)("td",{parentName:"tr",align:null},"x64"),(0,a.kt)("td",{parentName:"tr",align:null},"Dynamic library; testing is not run in this configuration")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Windows"),(0,a.kt)("td",{parentName:"tr",align:null},"MSVC"),(0,a.kt)("td",{parentName:"tr",align:null},"Debug, Release"),(0,a.kt)("td",{parentName:"tr",align:null},"x86"),(0,a.kt)("td",{parentName:"tr",align:null},"Dynamic library; testing is not run in this configuration")))),(0,a.kt)("h2",{id:"defensive-code"},"Defensive code"),(0,a.kt)("p",null,"H3 uses preprocessor macros borrowed from ",(0,a.kt)("a",{parentName:"p",href:"https://www.sqlite.org/testing.html"},"SQLite's testing methodology")," to include defensive code in the library. Defensive code is code that handles error conditions for which there are no known test cases to demonstrate it. The lack of known test cases means that without the macros, the defensive cases could inappropriately reduce coverage metrics, disincentivizing including them. The macros behave differently, depending on the build configuration:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Under release builds of the library (",(0,a.kt)("inlineCode",{parentName:"p"},"CMAKE_BUILD_TYPE=Release"),"), the defensive code is included without modification. These branches are intended to be very simple (usually only ",(0,a.kt)("inlineCode",{parentName:"p"},"return"),"ing an error code and possibly ",(0,a.kt)("inlineCode",{parentName:"p"},"free"),"ing some resources) and to be visually inspectable.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Under debug builds of the library (",(0,a.kt)("inlineCode",{parentName:"p"},"CMAKE_BUILD_TYPE=Debug"),"), the defensive code is included and ",(0,a.kt)("inlineCode",{parentName:"p"},"assert")," calls are included if the defensive code is invoked. Any unit test or fuzzer which can demonstrate the defensive code is actually reached will trigger a test failure and the developers can be alerted to cover the defensive code in unit tests.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Under coverage builds of the library (",(0,a.kt)("inlineCode",{parentName:"p"},"CMAKE_BUILD_TYPE=Debug ENABLE_COVERAGE=ON"),"), the defensive code is not included by replacing its condition with a constant value. The compiler removes the defensive code and it is not counted in coverage metrics. This is intended only for determining test coverage of the library."))),(0,a.kt)("h2",{id:"benchmarks"},"Benchmarks"),(0,a.kt)("p",null,"H3 uses benchmarks to offer a comparison of the library's performance between revisions."),(0,a.kt)("p",null,"Benchmarks are automatically run on Linux x64 with Clang and GCC compilers for each commit in Github Actions."),(0,a.kt)("h2",{id:"fuzzers"},"Fuzzers"),(0,a.kt)("p",null,"H3 uses ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/uber/h3/tree/master/src/apps/fuzzers"},"fuzzers")," to find novel inputs that crash or result in other undefined behavior."),(0,a.kt)("p",null,"On each commit, CI is triggered to run ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/google/oss-fuzz/tree/master/projects/h3"},"OSS-Fuzz")," for H3. OSS-Fuzz regularly runs fuzzers against the latest development version of H3 and reports newly discovered issues to the H3 core maintainers."))}c.isMDXComponent=!0}}]);